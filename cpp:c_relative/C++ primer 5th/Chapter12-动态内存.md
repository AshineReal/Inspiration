
# 动态内存

静态内存用来保存局部static对象、类static 数据成员以及定义在任何函数之外的变量。栈内存用来保存定义在函数内的非static对象。分配在静态内存和栈内存中的对象由编译器自动创建和销毁。

除了静态内存和栈内存，每个程序还拥有一个内存池这部分内存被称作自由空间（free store）或堆（heap）程序用堆来存储动态分配的对象及那些在程序运行时分配的对象。动态对象的生存期由程序来控制，也就是说，当动态对象不再使用时，我们的代码必须显式的销毁它们。

## 动态内存和智能指针

new在动态内存中为对象分配空间并返回一个指向该对象的指针，我们可以选择对对象进行初始化；delete接受一个动态对象的指针，销毁该对象，并释放与之关联的内存。

C++新的标准库提供了两种智能指针类型来管理对象

* shared_ptr 允许多个指针指向同一个对象；
* unique_ptr “独占”所指向的对象；
* weak_ptr 伴随类，是一种弱引用（不会增加引用计数），指向shared_ptr管理的对象

这三种类型都定义在memory头文件中。


### shared_ptr类
智能指针也是模版，因此创建一个智能指针时需要提供额外的信息--指针可以指向的类型。

```cpp
shared_ptr<string> p1; //智能指针p1可指向一个string对象
shared_ptr<list<int>> p2; //p2可指向一个int的list
```

智能指针类似于普通指针，解引用一个智能指针返回它所指向的对象
